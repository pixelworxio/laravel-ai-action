<?php

declare(strict_types=1);

namespace {{ namespace }};

use Pixelworxio\LaravelAiAction\Actions\RunAgentAction;
use Pixelworxio\LaravelAiAction\Concerns\InteractsWithAgent;
use Pixelworxio\LaravelAiAction\Contracts\AgentAction;
use Pixelworxio\LaravelAiAction\DTOs\AgentContext;
use Pixelworxio\LaravelAiAction\DTOs\AgentResult;

final class {{ class }} implements AgentAction
{
    use InteractsWithAgent;

    /**
     * Return the system-level instructions for this agent.
     *
     * These are sent as the system prompt on every invocation. Describe the
     * agent's role, persona, output format, and any invariant constraints here.
     * Keep this stable across requests — per-request variation belongs in prompt().
     *
     * @param AgentContext $context The runtime context for this invocation.
     * @return string The system prompt / instructions string.
     */
    public function instructions(AgentContext $context): string
    {
        return '';
    }

    /**
     * Return the user-facing prompt for this agent.
     *
     * Build the prompt dynamically from $context — pull in record attributes,
     * meta values, or user instructions. This is the variable input the model
     * reasons over on each individual call.
     *
     * Example:
     *   return sprintf("Summarise the following:\n\n%s", $context->record->body);
     *
     * @param AgentContext $context The runtime context for this invocation.
     * @return string The user prompt string.
     */
    public function prompt(AgentContext $context): string
    {
        return '';
    }

    /**
     * Execute the agent action and return a typed AgentResult.
     *
     * Delegate to RunAgentAction::execute() — do not put business logic here.
     * Pre-processing belongs in instructions() and prompt(); Post-processing
     * belongs in callers that consume the returned AgentResult.
     *
     * @param AgentContext $context The runtime context for this invocation.
     * @return AgentResult The typed result wrapping the AI response.
     */
    public function handle(AgentContext $context): AgentResult
    {
        return app(RunAgentAction::class)->execute($this, $context);
    }
}
